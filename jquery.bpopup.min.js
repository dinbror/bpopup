/*================================================================================
 * @name: bPopup - if you can't get it up, use bPopup
 * @author: (c)Bjoern Klinggaard (twitter@bklinggaard)
 * @demo: http://dinbror.dk/bpopup
 * @version: 0.11.0.min
 ================================================================================*/
!function(o){"use strict";o.fn.bPopup=function(t,n){function e(){w(y.onOpen),M=(L.data("bPopup")||0)+1,T=E+M+"__",x="auto"!==y.position[1],P="auto"!==y.position[0],U="fixed"===y.positionStyle,I=H.outerHeight(!0),S=H.outerWidth(!0),y.autoOpen&&(y.loadUrl?i():a())}function i(){switch(y.contentContainer=o(y.contentContainer||H),y.content){case"iframe":var t=o('<iframe class="b-iframe" '+y.iframeAttr+"></iframe>");t.appendTo(y.contentContainer),I=H.outerHeight(!0),S=H.outerWidth(!0),a(),t.attr("src",y.loadUrl),w(y.loadCallback);break;case"image":a(),o("<img />").load(function(){w(y.loadCallback),r(o(this))}).attr("src",y.loadUrl).hide().appendTo(y.contentContainer);break;default:a(),o('<div class="b-ajax-wrapper"></div>').load(y.loadUrl,y.loadData,function(t,n){w(y.loadCallback,n),r(o(this))}).hide().appendTo(y.contentContainer)}}function a(){y.modal&&(o("div.b-modal."+T).length||o('<div class="b-modal '+T+'"></div>').css({backgroundColor:y.modalColor,position:"fixed",top:0,right:0,bottom:0,left:0,opacity:0,zIndex:y.zIndex+M}).appendTo(y.appendTo).fadeTo(y.speed,y.opacity)),m(),H.data("bPopup",y).data("id",T).css({left:"slideIn"==y.transition||"slideBack"==y.transition?"slideBack"==y.transition?_.scrollLeft()+A:-1*(W+S):h(!(!y.follow[0]&&P||U)),position:y.positionStyle||"absolute",top:"slideDown"==y.transition||"slideUp"==y.transition?"slideUp"==y.transition?_.scrollTop()+j:O+-1*I:b(!(!y.follow[1]&&x||U)),"z-index":y.zIndex+M+1}).each(function(){y.appending&&o(this).appendTo(y.appendTo)}),p(!0)}function l(){return w(y.beforeClose),y.modal&&o(".b-modal."+H.data("id")).fadeTo(y.speed,0,function(){o(this).remove()}),u(),clearTimeout(B),p(),!1}function s(){y.modal&&o(".b-modal."+H.data("id")).remove(),u(),H.remove()}function d(t){j=g(),A=k(),v=C(),(v.x||v.y)&&(clearTimeout(z),z=setTimeout(function(){m(),t=t||y.followSpeed;var n={};v.x&&(n.left=y.follow[0]?h(!0):"auto"),v.y&&(n.top=y.follow[1]?b(!0):"auto"),H.dequeue().each(function(){U?o(this).css({left:W,top:O}):o(this).animate(n,t,y.followEasing)})},50))}function r(o){var t=o.width(),n=o.height(),e={};y.contentContainer.css({height:n,width:t}),n>=H.height()&&(e.height=H.height()),t>=H.width()&&(e.width=H.width()),I=H.outerHeight(!0),S=H.outerWidth(!0),m(),y.contentContainer.css({height:"auto",width:"auto"}),e.left=h(!(!y.follow[0]&&P||U)),e.top=b(!(!y.follow[1]&&x||U)),H.animate(e,250,function(){o.show(),v=C()})}function c(){L.data("bPopup",M),H.delegate(".bClose, ."+y.closeClass,"click."+T,l),y.modalClose&&o(".b-modal."+T).css("cursor","pointer").bind("click",l),q||!y.follow[0]&&!y.follow[1]||L.bind("scroll."+T,function(){if(v.x||v.y){var o={};v.x&&(o.left=y.follow[0]?h(!U):"auto"),v.y&&(o.top=y.follow[1]?b(!U):"auto"),H.dequeue().animate(o,y.followSpeed,y.followEasing)}}).bind("resize."+T,function(){d()}),y.escClose&&_.bind("keydown."+T,function(o){27==o.which&&l()})}function u(){y.scrollBar||o("html").css("overflow","auto"),o(".b-modal."+T).unbind("click"),_.unbind("keydown."+T),L.unbind("."+T).data("bPopup",L.data("bPopup")-1>0?L.data("bPopup")-1:null),H.undelegate(".bClose, ."+y.closeClass,"click."+T,l).data("bPopup",null)}function p(o){function t(t){H.css({display:"block",opacity:1}).animate(t,y.speed,y.easing,function(){f(o)})}switch(o?y.transition:y.transitionClose||y.transition){case"slideIn":t({left:o?h(!(!y.follow[0]&&P||U)):_.scrollLeft()-(S||H.outerWidth(!0))-F});break;case"slideBack":t({left:o?h(!(!y.follow[0]&&P||U)):_.scrollLeft()+A+F});break;case"slideDown":t({top:o?b(!(!y.follow[1]&&x||U)):_.scrollTop()-(I||H.outerHeight(!0))-F});break;case"slideUp":t({top:o?b(!(!y.follow[1]&&x||U)):_.scrollTop()+j+F});break;default:H.stop().fadeTo(y.speed,o?1:0,function(){f(o)})}}function f(o){o?(c(),w(n),y.autoClose&&(B=setTimeout(l,y.autoClose))):(H.hide(),w(y.onClose),y.loadUrl&&(y.contentContainer.empty(),H.css({height:"auto",width:"auto"})))}function h(o){return o?W+_.scrollLeft():W}function b(o){return o?O+_.scrollTop():O}function w(t,n){o.isFunction(t)&&t.call(H,n)}function m(){O=x?y.position[1]:Math.max(0,(j-H.outerHeight(!0))/2-y.amsl),W=null!=y.positionContainer?P?y.position[0]:(y.positionContainer.outerWidth()-H.outerWidth(!0))/2:P?y.position[0]:(A-H.outerWidth(!0))/2,v=C()}function C(){return{x:A>H.outerWidth(!0),y:j>H.outerHeight(!0)}}function g(){return L.height()}function k(){return L.width()}o.isFunction(t)&&(n=t,t=null);var y=o.extend({},o.fn.bPopup.defaults,t);y.afterOpen!==!1&&(n=y.afterOpen),y.scrollBar||o("html").css("overflow","hidden");var T,v,x,P,U,O,W,I,S,z,B,H=this,_=o(document),D=window,L=o(D),j=g(),A=k(),E="__b-popup",q=/OS 6(_\d)+/i.test(navigator.userAgent),F=200,M=0;return H.close=function(){l()},H.open=function(){a()},H.destroy=function(){s()},H.reposition=function(o){d(o)},H.each(function(){o(this).data("bPopup")||e()})},o.fn.bPopup.defaults={amsl:50,appending:!0,appendTo:"body",autoOpen:!1,autoClose:!1,closeClass:"b-close",content:"ajax",contentContainer:!1,easing:"swing",escClose:!0,follow:[!0,!0],followEasing:"swing",followSpeed:500,iframeAttr:'scrolling="no" frameborder="0"',loadCallback:!1,loadData:!1,loadUrl:!1,modal:!0,modalClose:!0,modalColor:"#000",onClose:!1,beforeClose:!1,onOpen:!1,afterOpen:!1,opacity:.7,position:["auto","auto"],positionStyle:"absolute",scrollBar:!0,speed:250,transition:"fadeIn",transitionClose:!1,zIndex:9997,positionContainer:null}}(jQuery);
